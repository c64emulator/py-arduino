<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
		<title>jQuery UI Example Page</title>
		<link type="text/css" href="css/ui-lightness/jquery-ui-1.8.13.custom.css" rel="stylesheet" />	
		<script type="text/javascript" src="js/jquery-1.5.1.min.js"></script>
		<script type="text/javascript" src="js/jquery-ui-1.8.13.custom.min.js"></script>
		<style type="text/css">
			body{ font: 62.5% sans-serif; margin: 20px; color: #777; }
			.pin_status_text { color: #333; }
			div.pwm_slide { padding-top: 5px; }
		</style>	
		<script type="text/javascript">
			$(function(){
				
				//
				// ping
				//
				
				$("#ping_button").button();
				$("#ping_button").click(function() {
					$("#ping_result").html('waiting for response...');
					$.ajax({
					  url: '/ping',
					  dataType: 'json',
					  success: function(data, textStatus, jqXHR) {
						  if(data.ok) {
							  $("#ping_result").html('PING OK');
						  } else {
							  $("#ping_result").html('no response');
						  }
					  },
					  error: function(jqXHR, textStatus, errorThrown) {
						alert('AJAX ERROR');
					  }
					});
				});
				
				//
				// validate_connection
				//
				
				$("#validate_connection_button").button();
				$("#validate_connection_button").click(function() {
					$("#validate_connection_result").html('waiting for response...');
					$.ajax({
					  url: '/validate_connection',
					  dataType: 'json',
					  success: function(data, textStatus, jqXHR) {
						  if(data.ok) {
							  $("#validate_connection_result").html('validation OK - ID: ' + data.random_value);
						  } else {
							  $("#validate_connection_result").html('ERROR');
						  }
					  },
					  error: function(jqXHR, textStatus, errorThrown) {
						alert('AJAX ERROR');
					  }
					});
				});
				
				//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
				// Generic functions
				//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
				
				function pin_status_text(pin, text) {
					$("#pin" + pin + "_status_text").html(text);
				}
				
				function pin_mode_disable(pin) {
					// $(this).attr('id') -> ID of component that generated the event :-)
					pin_status_text(pin, 'Pin disabled');
					$('.pin' + pin + '_for_read').hide();
					$('.pin' + pin + '_for_write').hide();
					// TODO: reset selected
				}
				
				function pin_mode_input(pin) {
					pin_status_text(pin, 'Mode: INPUT');
					$('.pin' + pin + '_for_read').show();
					$('.pin' + pin + '_for_write').hide();
					// TODO: reset selected
				}

				function pin_mode_output(pin) {
					pin_status_text(pin, 'Mode: OUTPUT');
					$('.pin' + pin + '_for_read').hide();
					$('.pin' + pin + '_for_write').show();
					// TODO: reset selected
				}
				
				function pin_digital_write_low(pin) {
					pin_status_text(pin, 'digitalWrite(): LOW');
					if($('#pin' + pin + '_pwm_slider').size()) {
						$('#pin' + pin + '_pwm_slider').slider("value", 0);
					}
				}

				function pin_digital_write_high(pin) {
					pin_status_text(pin, 'digitalWrite(): HIGH');
					if($('#pin' + pin + '_pwm_slider').size()) {
						$('#pin' + pin + '_pwm_slider').slider("value", 255);
					}
				}

				//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
				// Pin 13
				//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
				
				// Create buttons
				$(".pin13_mode_buttonset").buttonset();
				$(".pin13_output_buttonset").buttonset();
				$(".pin13_input_buttonset").buttonset();
				
				// Hide components
				$('.pin13_for_read').hide();
				$('.pin13_for_write').hide();
				
				// analogWrite() / PWM
				$("#pin13_pwm_slider").slider({
					value:0,
					min: 0,
					max: 255,
					step: 1,
					slide: function(event, ui) {
						pin_status_text(13, 'PWM: ' + ui.value);
						// TODO: uncheck LOW/HIGH
					}
				});
				
				//
				// Attach events
				//
				
				// pinMode(): disable
				$('#pin13_mode_dis').change(function() {
					pin_mode_disable(13);
				});
				
				// pinMode(): INPUT
				$('#pin13_mode_in').change(function() {
					pin_mode_input(13);
				});
				
				// pinMode(): OUTPUT
				$('#pin13_mode_out').change(function() {
					pin_mode_output(13);
				});

				// digitalRead()
				$("#pin13_dr_button").click(function() {
					pin_status_text(13, 'digitalRead(): HIGH');
				});
				
				// digitalWrite()
				$("#pin13_dw_lo").click(function() {
					pin_digital_write_low(13);
				});
				
				$("#pin13_dw_hi").click(function() {
					pin_digital_write_high(13);
				});
				
			});
		</script>
	</head>
	<body>
		
	<h1>Py-Arduino-Proxy</h1>
	
	<p>
		<button id="ping_button">Ping</button> &nbsp; | Result: <span id="ping_result"></span>
	</p>
	<p>
		<button id="validate_connection_button">Validate connection</button> &nbsp; | Result: <span id="validate_connection_result"></span>
	</p>
	
	<div id="pin13">
		<div>
			
			Pin 13 - Mode: &nbsp;
			
			<!-- This buttons set the pin mode -->
			<span class="pin13_mode_buttonset">
				<input type="radio" id="pin13_mode_dis" name="pin13_mode" checked="checked"/><label for="pin13_mode_dis">Disabled</label>
				<input type="radio" id="pin13_mode_in"  name="pin13_mode"/><label for="pin13_mode_in">INPUT</label>
				<input type="radio" id="pin13_mode_out" name="pin13_mode"/><label for="pin13_mode_out">OUTPUT</label>
			</span>
			
			<!-- digitalWrite() -->
			<span class="pin13_output_buttonset pin13_for_write">
				&nbsp; | digitalWrite()&nbsp;
				<input type="radio" id="pin13_dw_lo" name="pin13_dw" class="pin13_for_write"/><label for="pin13_dw_lo">LOW</label>
				<input type="radio" id="pin13_dw_hi" name="pin13_dw" class="pin13_for_write"/><label for="pin13_dw_hi">HIGH</label>
			</span>
			
			<!-- digitalRead() -->
			<span class="pin13_input_buttonset pin13_for_read">
				&nbsp; | &nbsp;
				<button id="pin13_dr_button">digitalRead()</button>
			</span>
			
			&nbsp; | <span id="pin13_status_text" class="pin_status_text">Pin disabled</span>
		</div>
		
		<!-- analogWrite() / PWM -->
		<div class="pin13_for_write pwm_slide">
			<div style="float: left; padding-right: 20px;">analogWrite():</div>
			<div style="width: 400px; float: left;"><div id="pin13_pwm_slider"></div></div>
			<div style="float: clear;"></div>
		</div>

	</div>
	
	</body>
</html>


